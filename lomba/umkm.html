<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marketplace UMKM Warga Desa</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .logo-wrapper {
      position: relative;
      display: inline-block;
    }
    .logo {
      font-size: 32px;
      position: relative;
      z-index: 2;
    }
    .logo-wrapper::before,
    .logo-wrapper::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    .logo-wrapper::before {
      background: #798e9d;
      transform: translate(-50%, -50%) rotate(0deg) translateX(22px);
      animation: orbit-cw 1.5s linear infinite;
      box-shadow: 0 0 6px #798e9d, 0 0 12px #798e9d;
    }
    .logo-wrapper::after {
      background: #bab2a7;
      transform: translate(-50%, -50%) rotate(180deg) translateX(22px);
      animation: orbit-ccw 1.5s linear infinite;
      box-shadow: 0 0 6px #bab2a7, 0 0 12px #bab2a7;
    }
    @keyframes orbit-cw {
      from { transform: translate(-50%, -50%) rotate(0deg) translateX(22px); }
      to   { transform: translate(-50%, -50%) rotate(360deg) translateX(22px); }
    }
    @keyframes orbit-ccw {
      from { transform: translate(-50%, -50%) rotate(180deg) translateX(22px); }
      to   { transform: translate(-50%, -50%) rotate(-180deg) translateX(22px); }
    }
    
    @keyframes dot-bounce {
      0%   { transform: scale(0.9); }
      50%  { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .dot-bounce {
      animation: dot-bounce 0.3s ease-out;
    }
    .dot-hover:hover {
      animation: dot-bounce 0.2s ease-out;
    }

  /* chatbot */
    :root {
      --c1: #383b4e;  
      --c2: #bab2a7;  
    }

    #chatbase-bubble-button {
      background-color: var(--c1) !important;
      border: 2px solid var(--c2) !important;
      color: white !important;
    }
  </style>
</head>
<body class="bg-[#d8dddd] text-gray-800 font-sans flex flex-col min-h-screen">

  <!-- NAVBAR -->
  <header class="bg-[#383b4e] text-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex justify-between items-center py-4 px-6">
      <!-- Logo -->
      <h1 class="text-2xl font-bold flex items-center gap-2">
        <a href="/lomba/jasa.html" class="logo-wrapper">
          <span class="logo">â¾•</span>
        </a>
        UMKM Mart
      </h1>

      <!-- Menu Desktop -->
      <nav class="hidden md:flex space-x-4">
        <button data-target="beranda" class="nav-btn px-3 py-1 rounded-lg bg-[#798e9d] hover:bg-[#bab2a7]">Beranda</button>
        <button data-target="aktif" class="nav-btn px-3 py-1 rounded-lg hover:bg-[#bab2a7]">Aktif</button>
        <button data-target="riwayat" class="nav-btn px-3 py-1 rounded-lg hover:bg-[#bab2a7]">Riwayat</button>
        <button data-target="batal" class="nav-btn px-3 py-1 rounded-lg hover:bg-[#bab2a7]">Batal</button>
        <button data-target="favorit" class="nav-btn px-3 py-1 rounded-lg hover:bg-[#bab2a7]">Favorit</button>
      </nav>

      <!-- Burger Menu Button -->
      <button id="burgerBtn" class="md:hidden flex flex-col justify-center items-center w-8 h-8 space-y-1">
        <span class="w-6 h-0.5 bg-white transition-all duration-300"></span>
        <span class="w-6 h-0.5 bg-white transition-all duration-300"></span>
        <span class="w-6 h-0.5 bg-white transition-all duration-300"></span>
      </button>

      <!-- Profile Dropdown -->
      <div class="relative hidden md:block">
        <button id="profileBtn" class="w-10 h-10 rounded-full flex items-center justify-center bg-[#bab2a7]">
          <span class="text-[#383b4e]">ðŸ‘¤</span>
        </button>
        <div id="profileMenu" class="hidden absolute right-0 mt-2 w-max min-w-[140px] bg-white rounded-lg shadow-lg overflow-hidden z-50">
          <a href="/lomba/profil.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profil</a>
          <a href="/lomba/login.html" id="logoutBtn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Log Out</a>
        </div>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobileMenu" 
         class="max-h-0 overflow-hidden transition-all duration-500 ease-in-out flex-col space-y-2 bg-[#2e3141] px-6 py-0 md:hidden">
      <button data-target="beranda" class="nav-btn w-full text-left px-3 py-2 rounded-lg bg-[#798e9d]">Beranda</button>
      <button data-target="aktif" class="nav-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#bab2a7]">Aktif</button>
      <button data-target="riwayat" class="nav-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#bab2a7]">Riwayat</button>
      <button data-target="batal" class="nav-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#bab2a7]">Batal</button>
      <button data-target="favorit" class="nav-btn w-full text-left px-3 py-2 rounded-lg hover:bg-[#bab2a7]">Favorit</button>
      <!-- Profil mobile -->
      <a href="/lomba/profil.html" class="block px-3 py-2 rounded-lg hover:bg-[#bab2a7]">Profil</a>
      <a href="/lomba/login.html" class="block px-3 py-2 rounded-lg hover:bg-[#bab2a7]">Log Out</a>
    </div>
  </header>

  <div class="flex-grow">
  <!-- BERANDA -->
    <section id="beranda" class="section flex-grow">
      <!-- HERO -->
      <section class="relative bg-cover bg-center h-72" style="background-image: url('/lomba/sawah.jpg');">
        <div class="absolute inset-0 bg-gradient-to-r from-[#383b4e]/70 to-[#798e9d]/50"></div>
        <div class="relative z-10 max-w-3xl mx-auto text-center text-white py-16 px-6">
          <h1 class="text-3xl sm:text-4xl font-bold mb-4">Temukan UMKM di Desa Anda</h1>
          <p class="mb-6 text-sm sm:text-base">Jelajahi berbagai UMKM di sekitar Anda. 
          Cepat, mudah, dan menguatkan ekonomi lokal.</p>
          <button id="heroSearchBtn" class="px-6 py-2 rounded-lg text-lg font-semibold bg-[#798e9d] hover:bg-[#bab2a7]">Cari UMKM</button>
        </div>
      </section>

      <!-- SEARCH FILTER -->
      <section id="searchSection" class="max-w-6xl mx-auto px-4 py-6">
        <div class="flex flex-col sm:flex-row gap-4 items-center">
          <input id="searchInput" type="text" placeholder="Cari: Tukang, Petani, Penjahit..." class="w-[90%] sm:w-auto flex-1 border border-gray-300 px-4 py-2 rounded-lg focus:ring-2 focus:ring-[#798e9d]" />
          <input id="lokasiInput" type="text" placeholder="+ lokasi (contoh: Kebun Agung)" class="w-[90%] sm:w-auto flex-1 border border-gray-300 px-4 py-2 rounded-lg focus:ring-2 focus:ring-[#798e9d]" />
          <div class="flex flex-col items-start sm:items-center">
            <div class="flex items-center space-x-2">
              <label for="rangeHarga" class="text-sm text-[#383b4e] font-medium">Harga</label>
              <input type="range" id="rangeHarga" min="20000" max="500000" step="20000" value="500000" class="w-40 accent-[#798e9d]">
              <span id="labelHarga" class="text-sm font-semibold text-[#383b4e]">â‰¤ Rp.500.000</span>
            </div>
          </div>
        </div>
      </section>

      <!-- KATEGORI -->
      <section class="max-w-6xl mx-auto px-4">
        <div id="kategoriBtns" class="flex gap-2 mb-6 overflow-x-auto pb-2">
          <button data-kategori="all" class="kategori-btn px-4 py-1 border rounded-full active bg-[#798e9d] text-white" style="border-color:#798e9d;">Semua</button>
          <button data-kategori="Kerajinan" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Kerajinan</button>
          <button data-kategori="Kue" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Kue</button>
          <button data-kategori="Makanan & Minuman" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Makanan & Minuman</button>
          <button data-kategori="Seni & Souvenir" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Seni & Souvenir</button>
          <button data-kategori="Lainnya" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Lainnya</button>
        </div>
      </section>

      <!-- LIST UMKM -->
      <section class="max-w-6xl mx-auto px-4 pb-12">
        <div id="UMKMGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
        <div id="pagination" class="flex justify-center space-x-3 mt-6"></div>
      </section>
    </section>

    <!-- SECTION TAMBAHAN -->
    <main id="aktif" class="section hidden max-w-6xl mx-auto px-4 py-12 text-center ">
      <p class="text-lg text-gray-600">Belum ada UMKM aktif.</p>
    </main>

    <main id="riwayat" class="section hidden max-w-6xl mx-auto px-4 py-12 text-center">
      <p class="text-lg text-gray-600">Riwayat transaksi akan muncul di sini.</p>
    </main>

    <main id="batal" class="section hidden max-w-6xl mx-auto px-4 py-12 text-center">
      <p class="text-lg text-gray-600">Belum ada transaksi batal.</p>
    </main>

    <main id="favorit" class="section hidden max-w-6xl mx-auto px-4 py-12">
      <h2 class="text-2xl font-bold mb-6 text-center">Favorit Saya</h2>
      <div id="favorit-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
    </main>
  </div>

  <!-- FOOTER -->
  <footer class="bg-[#383b4e] text-white py-10 mt-12">
    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 px-6 text-center">
      <div>
        <h4 class="font-semibold mb-2">Dapatkan Info Terbaru</h4>
        <input type="email" placeholder="Email Anda" class="w-full px-3 py-2 rounded-lg text-gray-800 mb-2 text-center" />
        <button class="w-full py-2 rounded-lg bg-[#798e9d] hover:bg-[#bab2a7]">Submit</button>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Navigasi</h4>
        <ul class="space-y-1 text-sm">
          <li><a href="#" class="footer-link" data-target="beranda">Beranda</a></li>
          <li><a href="#" class="footer-link" data-target="aktif">Aktif</a></li>
          <li><a href="#" class="footer-link" data-target="riwayat">Riwayat</a></li>
          <li><a href="#" class="footer-link" data-target="batal">Batal</a></li>
          <li><a href="#" class="footer-link" data-target="favorit">Favorit</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Kontak</h4>
        <p>(+62) 895-1632-6049</p>
        <p>UMKMMart@desa.go.id</p>
        <p>Jl. Raya Desa No.1, Jawa Timur</p>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Jam Operasional</h4>
        <p>Senin â€“ Kamis: 08.00â€“16.00</p>
        <p>Jumat â€“ Minggu: 08.00â€“12.00</p>
        <button class="mt-2 py-2 px-4 rounded-lg bg-[#798e9d] hover:bg-[#bab2a7]">Hubungi via WhatsApp</button>
      </div>
    </div>
    <p class="text-center text-sm mt-6">&copy; 2025 UMKM Mart. All Rights Reserved.</p>
  </footer>
  <!-- MODAL ULAS -->
  <div id="ulasModal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="relative w-full max-w-md mx-4 rounded-2xl shadow-xl p-6 bg-white"
         style="border:1px solid #bab2a7;">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-[#383b4e]">Beri Ulasan</h3>
        <button id="closeUlas" class="px-2 py-1 rounded-lg text-sm" style="background-color:#bab2a7;color:#383b4e;">Tutup</button>
      </div>
      <div class="space-y-4">
        <div class="flex items-center space-x-2">
          <span class="text-sm text-[#383b4e]">Rating:</span>
          <div id="ratingStars" class="flex space-x-1"></div>
          <span id="ratingValue" class="text-sm font-semibold text-[#383b4e]">(0)</span>
        </div>
        <textarea id="ratingNote" rows="3" placeholder="Tulis komentar (opsional)"
          class="w-full border border-[#bab2a7] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#798e9d]"></textarea>
        <button id="submitUlas" class="w-full py-2 rounded-lg text-white font-semibold"
          style="background-color:#383b4e;">Kirim</button>
      </div>
    </div>
  </div>
  
  <script>
    // === HAMBURGER MENU ===
    const burgerBtn = document.getElementById("burgerBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    const spans = burgerBtn.querySelectorAll("span");

    burgerBtn.addEventListener("click", () => {
      // Toggle slide menu
      if (mobileMenu.classList.contains("max-h-0")) {
        mobileMenu.classList.remove("max-h-0", "py-0");
        mobileMenu.classList.add("max-h-[500px]", "py-4");
      } else {
        mobileMenu.classList.remove("max-h-[500px]", "py-4");
        mobileMenu.classList.add("max-h-0", "py-0");
      }

      // Animasi burger -> X
      spans[0].classList.toggle("rotate-45");
      spans[0].classList.toggle("translate-y-1");

      spans[1].classList.toggle("opacity-0");

      spans[2].classList.toggle("-rotate-45");
      spans[2].classList.toggle("-translate-y-2");
    });

    // === DROPDOWN PROFIL ===
    const profileBtn = document.getElementById("profileBtn");
    const profileMenu = document.getElementById("profileMenu");

    profileBtn.addEventListener("click", () => {
      profileMenu.classList.toggle("hidden");
    });

    // klik di luar dropdown -> tutup
    document.addEventListener("click", (e) => {
      if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
        profileMenu.classList.add("hidden");
      }
    });

    // tombol logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      alert("Anda berhasil logout!");
      window.location.href = "login.html"; // arahkan ke login.html (bisa kamu ubah)
    });
  </script>

  <script>
    // ================== DATA UMKM ==================
    const UMKMData = [
      { id:1, nama:"Buket Bunga Bu Mawar", kategori:"Seni & Souvenir", lokasi:"Desa Sumberlele", harga:75000, deskripsi:"Buket bunga segar untuk wisuda, ulang tahun, dan acara spesial.", wa:"628123001001", ratingNumber:4.7, ratingCount:23 },
      { id:2, nama:"Kerajinan Bambu Pak Asri", kategori:"Kerajinan", lokasi:"Desa Sumberlele", harga:45000, deskripsi:"Tas anyaman, tempat pensil, dan hiasan dinding dari bambu.", wa:"628123001002", ratingNumber:4.9, ratingCount:31 },
      { id:3, nama:"Kue Tradisional Mak Yani", kategori:"Kue", lokasi:"Desa Kebon Agong", harga:25000, deskripsi:"Kue lapis, onde-onde, klepon, dan jajanan pasar lainnya.", wa:"628123001003", ratingNumber:4.5, ratingCount:18 },
      { id:4, nama:"Keripik Singkong Bu Dewi", kategori:"Makanan & Minuman", lokasi:"Desa Kebon Agung", harga:15000, deskripsi:"Keripik singkong renyah dengan berbagai varian rasa pedas manis.", wa:"628123001004", ratingNumber:4.3, ratingCount:14 },
      { id:5, nama:"Rajut Handmade Mas Fikri", kategori:"Kerajinan", lokasi:"Desa Asembakor", harga:85000, deskripsi:"Tas rajut, topi, dan aksesoris rajutan dengan motif unik.", wa:"628123001005", ratingNumber:4.8, ratingCount:40 },
      { id:6, nama:"Sambal Pecel Bu Tini", kategori:"Makanan & Minuman", lokasi:"Desa Sumberlele", harga:12000, deskripsi:"Sambal pecel khas Jawa Timur, pedas gurih untuk lalapan.", wa:"628123001006", ratingNumber:4.6, ratingCount:21 },
      { id:7, nama:"Batik Tulis Ibu Lestari", kategori:"Seni & Souvenir", lokasi:"Desa Karanganyar", harga:150000, deskripsi:"Kain batik tulis motif klasik dan modern.", wa:"628123001007", ratingNumber:4.8, ratingCount:27 },
      { id:8, nama:"Madu Hutan Pak Rudi", kategori:"Makanan & Minuman", lokasi:"Desa Asembakor", harga:60000, deskripsi:"Madu hutan murni asli tanpa campuran, kemasan botol 500ml.", wa:"628123001008", ratingNumber:4.7, ratingCount:22 },
      { id:9, nama:"Kerajinan Kulit Pak Darto", kategori:"Kerajinan", lokasi:"Desa Kebon Agung", harga:120000, deskripsi:"Dompet, ikat pinggang, dan tas kulit asli handmade.", wa:"628123001009", ratingNumber:4.9, ratingCount:19 },
      { id:10, nama:"Kopi Desa Wonosari Pak Joko", kategori:"Makanan & Minuman", lokasi:"Desa Karanganyar", harga:35000, deskripsi:"Kopi robusta bubuk khas desa, aroma kuat rasa mantap.", wa:"628123001010", ratingNumber:4.6, ratingCount:33 },
      { id:11, nama:"Anyaman Pandan Bu Rini", kategori:"Kerajinan", lokasi:"Desa Sumberlele", harga:40000, deskripsi:"Tikar, tas, dan dompet dari anyaman pandan.", wa:"628123001011", ratingNumber:4.4, ratingCount:16 },
      { id:12, nama:"Brownies Panggang Mbak Susi", kategori:"Kue", lokasi:"Desa Asembakor", harga:50000, deskripsi:"Brownies panggang cokelat lembut, tersedia varian keju & kacang.", wa:"628123001012", ratingNumber:4.8, ratingCount:28 },
      { id:13, nama:"Es Krim Tradisional Pak Didi", kategori:"Makanan & Minuman", lokasi:"Desa Karanganyar", harga:10000, deskripsi:"Es puter kelapa muda, durian, dan kacang hijau, segar alami.", wa:"628123001013", ratingNumber:4.5, ratingCount:21 },
      { id:14, nama:"Souvenir Kayu Kreatif Pak Andi", kategori:"Seni & Souvenir", lokasi:"Desa Kebon Agung", harga:70000, deskripsi:"Souvenir pernikahan, hiasan meja, dan gantungan kunci kayu.", wa:"628123001014", ratingNumber:4.7, ratingCount:26 },
      { id:15, nama:"Kerupuk Ikan Bu Sumarni", kategori:"Makanan & Minuman", lokasi:"Desa Sumberlele", harga:18000, deskripsi:"Kerupuk ikan gurih dan renyah, cocok untuk lauk dan camilan.", wa:"628123001015", ratingNumber:4.6, ratingCount:32 },
      { id:16, nama:"Topi Rajut Mbak Fitri", kategori:"Kerajinan", lokasi:"Desa Asembakor", harga:55000, deskripsi:"Topi rajut hangat dan stylish, tersedia berbagai warna.", wa:"628123001016", ratingNumber:4.7, ratingCount:20 }
    ];


    // Muat pembaruan rating tersimpan (localStorage)
    const savedRatings = JSON.parse(localStorage.getItem("UMKMMart_ratings") || "{}");
    for (const id in savedRatings) {
      const idx = UMKMData.findIndex(j => j.id === Number(id));
      if (idx > -1) Object.assign(UMKMData[idx], savedRatings[id]);
    }

    let favoritData = []; // simpan id UMKM yang di-favoritkan

    const UMKMGrid = document.getElementById("UMKMGrid");
    const searchInput = document.getElementById("searchInput");
    const lokasiInput = document.getElementById("lokasiInput");
    const rangeHarga = document.getElementById("rangeHarga");
    const labelHarga = document.getElementById("labelHarga");
    const favoritList = document.getElementById("favorit-list");

    // ===== Helper Rating
    function starText(avg){
      const full = Math.floor(avg);
      const half = (avg - full >= 0.5) ? 1 : 0;
      const empty = 5 - full - half;
      return "â˜…".repeat(full) + (half ? "â˜†" : "") + "â˜†".repeat(empty);
    }
    function ratingLabel(j){
      return `${starText(j.ratingNumber)} (${j.ratingNumber.toFixed(1)})`;
    }

    // ================== RENDER CARD BERANDA ==================
    // === PAGINATION ===
    let currentPage = 1;
    const itemsPerPage = 6;

  function renderPagination(totalItems) {
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    const container = document.querySelector("#pagination");
    container.innerHTML = "";

    for (let i = 1; i <= totalPages; i++) {
      const dot = document.createElement("button");
      dot.className =
        (i === currentPage
          ? "w-3 h-3 bg-[#383b4e] scale-100 dot-bounce"
          : "w-3 h-3 bg-white hover:bg-[#798e9d] scale-100") +
        " rounded-full border border-[#383b4e] transition-all duration-300 dot-hover";

      dot.addEventListener("click", () => {
        currentPage = i;
        applyFilter(); // render ulang sesuai halaman
      });

      container.appendChild(dot);
    }
  }

    function renderUMKM(data) {
      UMKMGrid.innerHTML = "";

      // hitung index untuk halaman ini
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageData = data.slice(start, end);

      if (pageData.length === 0) {
        UMKMGrid.innerHTML =
          `<p class="col-span-3 text-center text-gray-600">Tidak ada UMKM ditemukan</p>`;
      } else {
        pageData.forEach(j => {
          const isFav = favoritData.includes(j.id);
          const waLink = `https://wa.me/${j.wa}?text=${encodeURIComponent("Halo " + j.nama + ", saya tertarik menggunakan UMKM Anda.")}`;
          const [stars, paren] = [ratingLabel(j).split(" ")[0], `(${j.ratingNumber.toFixed(1)})`];

          UMKMGrid.innerHTML += `
            <div class="card bg-white rounded-xl shadow-md p-4">
              <h3 class="font-bold text-lg">${j.nama}</h3>
              <p class="text-sm mb-2">${j.deskripsi} <br> <span class="italic">${j.lokasi}</span></p>
              <p class="font-semibold mb-2 text-[#798e9d]">Rp ${j.harga.toLocaleString("id-ID")} / sesi</p>
              <div class="flex items-center mb-4">
                <span class="text-yellow-400">${stars}</span>
                <span class="ml-2 text-sm text-gray-500">${paren}</span>
              </div>
              <div class="flex justify-between items-center">
                <a href="${waLink}" target="_blank" rel="noopener" class="text-white px-3 py-1 rounded-lg" style="background-color:#383b4e;">Hubungi</a>
                <button class="ulasan-btn text-sm text-[#4c3d3e]" data-id="${j.id}">Ulas</button>
                <button class="favorite-btn ${isFav ? "text-red-500" : "text-gray-400"} text-lg" data-id="${j.id}">â™¥</button>
              </div>
            </div>
          `;
        });
      }

      // render pagination sesuai jumlah data
      renderPagination(data.length);

      // Event tombol favorit
      document.querySelectorAll(".favorite-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.dataset.id);
          if (favoritData.includes(id)) {
            favoritData = favoritData.filter(f => f !== id);
          } else {
            favoritData.push(id);
          }
          applyFilter();
          renderFavorit();
        });
      });

      // Event tombol ulas
      document.querySelectorAll(".ulasan-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          openUlasModal(parseInt(btn.dataset.id));
        });
      });
    }


      // Event tombol favorit (di kartu)
      document.querySelectorAll(".favorite-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = parseInt(btn.dataset.id);
          if(favoritData.includes(id)){
            favoritData = favoritData.filter(f=>f!==id);
          }else{
            favoritData.push(id);
          }
          applyFilter();  // re-render beranda
          renderFavorit(); // update halaman favorit
        });
      });

      // Event tombol ulas (di kartu)
      document.querySelectorAll(".ulasan-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          openUlasModal(parseInt(btn.dataset.id));
        });
      });
      

    // ================== RENDER FAVORIT ==================
    function renderFavorit(){
      favoritList.innerHTML = "";
      if(favoritData.length === 0){
        favoritList.innerHTML = `<p class="col-span-3 text-center text-gray-600">Belum ada favorit</p>`;
        return;
      }
      UMKMData.filter(j=>favoritData.includes(j.id)).forEach(j=>{
        const waLink = `https://wa.me/${j.wa}?text=${encodeURIComponent("Halo "+j.nama+", saya tertarik menggunakan UMKM Anda.")}`;
        favoritList.innerHTML += `
          <div class="card bg-white rounded-xl shadow-md p-4">
            <h3 class="font-bold text-lg">${j.nama}</h3>
            <p class="text-sm mb-2">${j.deskripsi} <br> <span class="italic">${j.lokasi}</span></p>
            <p class="font-semibold mb-2 text-[#798e9d]">Rp ${j.harga.toLocaleString("id-ID")} / sesi</p>
            <div class="flex items-center mb-4">
              <span class="text-yellow-400">${starText(j.ratingNumber)}</span>
              <span class="ml-2 text-sm text-gray-500">(${j.ratingNumber.toFixed(1)})</span>
            </div>
            <div class="flex justify-between items-center">
              <a href="${waLink}" target="_blank" rel="noopener" class="text-white px-3 py-1 rounded-lg" style="background-color:#383b4e;">Hubungi</a>
              <button class="ulasan-btn text-sm text-[#4c3d3e]" data-id="${j.id}">Ulas</button>
              <button class="favorite-btn text-red-500 text-lg" data-id="${j.id}">â™¥</button>
            </div>
          </div>
        `;
      });

      // Hapus favorit dari halaman Favorit
      document.querySelectorAll("#favorit .favorite-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = parseInt(btn.dataset.id);
          favoritData = favoritData.filter(f=>f!==id);
          applyFilter();
          renderFavorit();
        });
      });

      // Ulas dari halaman Favorit
      document.querySelectorAll("#favorit .ulasan-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          openUlasModal(parseInt(btn.dataset.id));
        });
      });
    }

    // ================== FILTER ==================
    function applyFilter() {
      let keyword = searchInput.value.toLowerCase();
      let lokasi = lokasiInput.value.toLowerCase();
      let maxHarga = parseInt(rangeHarga.value);
      let kategoriActive = document.querySelector(".kategori-btn.active")?.dataset.kategori || "all";

      let hasil = UMKMData.filter(j => {
        let cocokNama = j.nama.toLowerCase().includes(keyword) || j.deskripsi.toLowerCase().includes(keyword);
        let cocokLokasi = lokasi === "" || j.lokasi.toLowerCase().includes(lokasi);
        let cocokHarga = j.harga <= maxHarga;
        let cocokKategori = kategoriActive === "all" || j.kategori === kategoriActive;
        return cocokNama && cocokLokasi && cocokHarga && cocokKategori;
      });

      // reset halaman kalau melebihi jumlah hasil
      if (currentPage > Math.ceil(hasil.length / itemsPerPage)) {
        currentPage = 1;
      }

      labelHarga.innerText = `â‰¤ Rp.${maxHarga.toLocaleString("id-ID")}`;
      renderUMKM(hasil);
    }


    // ================== EVENT FILTER UI ==================
    searchInput.addEventListener("input", applyFilter);
    lokasiInput.addEventListener("input", applyFilter);
    rangeHarga.addEventListener("input", applyFilter);

    document.querySelectorAll(".kategori-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".kategori-btn").forEach(b=> b.classList.remove("bg-[#798e9d]","text-white","active"));
        btn.classList.add("bg-[#798e9d]","text-white","active");
        applyFilter();
      });
    });

    // Hero button scroll ke search
    document.getElementById("heroSearchBtn").addEventListener("click", ()=>{
      document.getElementById("searchSection").scrollIntoView({behavior:"smooth"});
    });

    // ================== NAVIGASI (Navbar + Mobile + Footer) ==================
    const navBtns = document.querySelectorAll(".nav-btn");
    const sections = document.querySelectorAll(".section");
    const footerLinks = document.querySelectorAll(".footer-link");
    const validTargets = new Set(["beranda","aktif","riwayat","batal","favorit"]);

    function activateNav(targetId) {
      if (!validTargets.has(targetId)) targetId = "beranda";

      // Sembunyikan semua section & tampilkan target
      sections.forEach(sec => sec.classList.add("hidden"));
      document.getElementById(targetId).classList.remove("hidden");

      // Reset + highlight tombol nav yang aktif (desktop & mobile)
      navBtns.forEach(b => b.classList.remove("bg-[#798e9d]","text-white"));
      navBtns.forEach(b => {
        if (b.dataset.target === targetId) {
          b.classList.add("bg-[#798e9d]","text-white");
        }
      });

      // Render favorit jika perlu
      if (targetId === "favorit") renderFavorit();

      // Tutup mobile menu jika terbuka
      if (!mobileMenu.classList.contains("max-h-0")) {
        burgerBtn.click();
      }
    }

    // Klik navbar & mobile nav
    navBtns.forEach(btn => {
      btn.addEventListener("click", () => activateNav(btn.dataset.target));
    });

    // Klik footer
    footerLinks.forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        activateNav(link.dataset.target);
      });
    });

    // ================== MODAL ULAS ==================
    const ulasModal = document.getElementById("ulasModal");
    const closeUlas = document.getElementById("closeUlas");
    const ratingStars = document.getElementById("ratingStars");
    const ratingValue = document.getElementById("ratingValue");
    const ratingNote  = document.getElementById("ratingNote");
    const submitUlas  = document.getElementById("submitUlas");
    let currentUlasId = null;
    let chosenRating = 0;

    function drawStars(current=0){
      ratingStars.innerHTML = "";
      for(let i=1;i<=5;i++){
        const b = document.createElement("button");
        b.type="button";
        b.className="text-2xl";
        b.textContent = i<=current ? "â˜…" : "â˜†";
        b.style.color = i<=current ? "#fbbf24" : "#9ca3af"; // amber-400 / gray-400
        b.addEventListener("click", ()=>{
          chosenRating = i;
          drawStars(i);
        });
        ratingStars.appendChild(b);
      }
      ratingValue.textContent = `(${current})`;
    }

    function openUlasModal(id){
      currentUlasId = id;
      chosenRating = 0;
      ratingNote.value = "";
      drawStars(0);
      ulasModal.classList.remove("hidden");
      ulasModal.classList.add("flex");
    }
    function closeModal(){
      ulasModal.classList.add("hidden");
      ulasModal.classList.remove("flex");
    }
    closeUlas.addEventListener("click", closeModal);
    ulasModal.addEventListener("click", (e)=>{ if(e.target === ulasModal) closeModal(); });

    submitUlas.addEventListener("click", ()=>{
      if(!currentUlasId) return;
      if(chosenRating === 0){
        alert("Pilih rating 1â€“5 dulu ya.");
        return;
      }
      const j = UMKMData.find(x=>x.id===currentUlasId);
      if(!j) return;

      // update rata-rata
      const total = j.ratingNumber * j.ratingCount + chosenRating;
      j.ratingCount += 1;
      j.ratingNumber = total / j.ratingCount;

      // simpan ke localStorage biar persistent
      const map = JSON.parse(localStorage.getItem("UMKMMart_ratings") || "{}");
      map[j.id] = { ratingNumber: j.ratingNumber, ratingCount: j.ratingCount };
      localStorage.setItem("UMKMMart_ratings", JSON.stringify(map));

      applyFilter();      // re-render kartu di beranda dgn rating baru
      renderFavorit();    // re-render favorit jika terbuka
      closeModal();
    });

    // ================== INIT ==================
    applyFilter();   // render awal beranda
    renderFavorit(); // siapkan konten favorit
    activateNav("beranda"); // pastikan default tampilan & highlight
    

    // === CHATBOT AI (biarkan seperti aslinya) ===
    (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized")
    {window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}
    window.chatbase.q.push(arguments)};
    window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}
    const onLoad=function(){const script=document.createElement("script");
    script.src="https://www.chatbase.co/embed.min.js";script.id="qyImtPkSzw_FeFA904WKD";
    script.domain="www.chatbase.co";document.body.appendChild(script)};
    if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
  </script>

</body>
</html>

