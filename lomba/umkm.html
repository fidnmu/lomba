<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marketplace UMKM Warga Desa</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .logo-wrapper {
      position: relative;
      display: inline-block;
    }

    .logo {
      font-size: 32px; /* ukuran simbol â¾• */
      position: relative;
      z-index: 2;
    }

    /* Titik cahaya pertama */
    .logo-wrapper::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 6px;
      height: 6px;
      background: #798e9d;
      border-radius: 50%;
      transform: translate(-50%, -50%) rotate(0deg) translateX(22px);
      animation: orbit-cw 1.5s linear infinite;
      box-shadow: 0 0 6px #798e9d, 0 0 12px #798e9d;
    }

    /* Titik cahaya kedua */
    .logo-wrapper::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 6px;
      height: 6px;
      background: #bab2a7;
      border-radius: 50%;
      transform: translate(-50%, -50%) rotate(180deg) translateX(22px);
      animation: orbit-ccw 1.5s linear infinite;
      box-shadow: 0 0 6px #bab2a7, 0 0 12px #bab2a7;
    }

    /* Orbit searah jarum jam */
    @keyframes orbit-cw {
      from { transform: translate(-50%, -50%) rotate(0deg) translateX(22px); }
      to   { transform: translate(-50%, -50%) rotate(360deg) translateX(22px); }
    }

    /* Orbit berlawanan arah jarum jam */
    @keyframes orbit-ccw {
      from { transform: translate(-50%, -50%) rotate(180deg) translateX(22px); }
      to   { transform: translate(-50%, -50%) rotate(-180deg) translateX(22px); }
    }

  </style>
</head>
<body class="bg-[#d8dddd] text-gray-800 font-sans">

  <!-- NAVBAR -->
  <header class="text-white shadow-md" style="background-color:#383b4e;">
    <div class="max-w-7xl mx-auto flex justify-between items-center py-4 px-6">
    <h1 class="text-2xl font-bold flex items-center">
      <a href="/lomba/jasa.html" class="logo-wrapper relative inline-block mr-2">
        <span class="logo">â¾•</span>
      </a>
      UMKM Mart
    </h1>
      <nav id="navbar" class="space-x-4">
        <button data-target="beranda" class="nav-btn px-3 py-1 rounded-lg bg-[#798e9d] hover:bg-[#bab2a7]">Beranda</button>
        <button data-target="aktif" class="nav-btn px-3 py-1 rounded-lg hover:bg-[#bab2a7]">Aktif</button>
        <button data-target="riwayat" class="nav-btn px-3 py-1 rounded-lg hover:bg-[#bab2a7]">Riwayat</button>
        <button data-target="batal" class="nav-btn px-3 py-1 rounded-lg hover:bg-[#bab2a7]">Batal</button>
        <button data-target="favorit" class="nav-btn px-3 py-1 rounded-lg hover:bg-[#bab2a7]">Favorit</button>
      </nav>
      <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color:#bab2a7;">
        <!-- PROFIL DROPDOWN -->
      <div class="relative">
        <button id="profileBtn" class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color:#bab2a7;">
          <span class="text-[#383b4e]">ðŸ‘¤</span>
        </button>

        <!-- Dropdown -->
        <div id="profileMenu" class="hidden absolute right-0 mt-2 w-max min-w-[120px] bg-white rounded-lg shadow-lg overflow-hidden z-50">
          <a href="/lomba/profil.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profil</a>
          <a href="/lomba/login.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Log Out</a>
        </div>
      </div>
      </div>
    </div>
  </header>

  <!-- BERANDA -->
  <main id="beranda" class="section">
    <!-- HERO -->
    <section class="relative bg-cover bg-center h-72" style="background-image: url('/lomba/sawah.jpg');">
      <div class="absolute inset-0 bg-gradient-to-r from-[#383b4e]/70 to-[#798e9d]/50"></div>
      <div class="relative z-10 max-w-3xl mx-auto text-center text-white py-16 px-6">
        <h1 class="text-3xl font-bold mb-4">Temukan UMKM di Desa Anda</h1>
        <p class="mb-6">Jelajahi berbagai UMKM di sekitar Anda. 
          Cepat, mudah, dan menguatkan ekonomi lokal.
        </p>
        <button id="heroSearchBtn" class="px-6 py-2 rounded-lg text-lg font-semibold" style="background-color:#798e9d;">
          Cari UMKM
        </button>
      </div>
    </section>

    <!-- SEARCH FILTER -->
    <section id="searchSection" class="max-w-6xl mx-auto px-4 py-6">
      <div class="flex flex-col sm:flex-row gap-4 items-center">
        <input id="searchInput" type="text" placeholder="Cari: Kerajinan, Kue, Olahan..."
          class="flex-1 border border-gray-300 px-4 py-2 rounded-lg focus:ring-2 focus:ring-[#798e9d]" />
        <input id="lokasiInput" type="text" placeholder="+ lokasi (contoh: Kebun Agung)"
          class="flex-1 border border-gray-300 px-4 py-2 rounded-lg focus:ring-2 focus:ring-[#798e9d]" />
        <div class="flex flex-col items-start">
          <div class="flex items-center space-x-2">
            <label for="rangeHarga" class="text-sm text-[#383b4e] font-medium">Harga</label>
            <input type="range" id="rangeHarga"
              min="20000" max="500000" step="20000" value="500000"
              class="w-40 accent-[#798e9d]">
            <span id="labelHarga" class="text-sm font-semibold text-[#383b4e]">â‰¤ Rp.500.000</span>
          </div>
        </div>
      </div>
    </section>

    <!-- KATEGORI -->
    <section class="max-w-6xl mx-auto px-4">
      <div id="kategoriBtns" class="flex gap-2 mb-6 overflow-x-auto">
        <button data-kategori="all" class="kategori-btn px-4 py-1 text-white rounded-full" style="background-color:#798e9d;">Semua</button>
        <button data-kategori="Kerajinan" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Kerajinan</button>
        <button data-kategori="Kue" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Kue</button>
        <button data-kategori="Olahan" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Olahan</button>
        <button data-kategori="Karya Seni" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Karya Seni</button>
        <button data-kategori="Lainnya" class="kategori-btn px-4 py-1 border rounded-full" style="border-color:#798e9d;">Lainnya</button>
      </div>
    </section>

    <!-- LIST UMKM -->
    <section class="max-w-6xl mx-auto px-4 pb-12" id="UMKM-list">
      <div id="UMKMGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
      <!-- PAGINATION -->
      <div class="flex justify-center space-x-3 mt-6">
        <button class="px-3 py-1 border border-gray-400 rounded-full">1</button>
        <button class="px-3 py-1 border border-gray-400 rounded-full">2</button>
        <button class="px-3 py-1 border border-gray-400 rounded-full">3</button>
        <span class="px-3 py-1">...</span>
      </div>
    </section>
  </main>

  <!-- AKTIF -->
  <main id="aktif" class="section hidden">
    <div class="max-w-6xl mx-auto px-4 py-12 text-center">
      <p class="text-lg text-gray-600">Belum ada UMKM aktif.</p>
    </div>
  </main>

  <!-- RIWAYAT -->
  <main id="riwayat" class="section hidden">
    <div class="max-w-6xl mx-auto px-4 py-12 text-center">
      <p class="text-lg text-gray-600">Riwayat transaksi akan muncul di sini.</p>
    </div>
  </main>

  <!-- BATAL -->
  <main id="batal" class="section hidden">
    <div class="max-w-6xl mx-auto px-4 py-12 text-center">
      <p class="text-lg text-gray-600">Belum ada transaksi batal.</p>
    </div>
  </main>

  <!-- FAVORIT -->
  <main id="favorit" class="section hidden">
    <div class="max-w-6xl mx-auto px-4 py-12">
      <h2 class="text-2xl font-bold mb-6 text-center">Favorit Saya</h2>
      <div id="favorit-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="text-white py-8 mt-12" style="background-color:#383b4e;">
    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 px-6">
      <div>
        <h4 class="font-semibold mb-2">Dapatkan Info Terbaru</h4>
        <input type="email" placeholder="Email Anda" class="w-full px-3 py-2 rounded-lg text-gray-800 mb-2" />
        <button class="w-full py-2 rounded-lg" style="background-color:#798e9d;">Submit</button>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Navigasi</h4>
        <ul class="space-y-1">
          <li><a href="#">Beranda</a></li>
          <li><a href="#">Cari UMKM</a></li>
          <li><a href="#">Riwayat</a></li>
          <li><a href="#">Favorit</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Kontak</h4>
        <p>(+62) 895-1632-6049</p>
        <p>UMKMMart@desa.go.id</p>
        <p>Jl. Raya Desa No.1, Jawa Timur</p>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Jam Operasional</h4>
        <p>Senin â€“ Kamis: 08.00â€“16.00</p>
        <p>Jumat â€“ Minggu: 08.00â€“12.00</p>
        <button class="mt-2 py-2 px-4 rounded-lg" style="background-color:#798e9d;">Hubungi via WhatsApp</button>
      </div>
    </div>
    <p class="text-center text-sm mt-6">&copy; 2025 UMKM Mart. All Rights Reserved.</p>
  </footer>

  <!-- MODAL ULAS -->
  <div id="ulasModal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="relative w-full max-w-md mx-4 rounded-2xl shadow-xl p-6 bg-white"
         style="border:1px solid #bab2a7;">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-[#383b4e]">Beri Ulasan</h3>
        <button id="closeUlas" class="px-2 py-1 rounded-lg text-sm" style="background-color:#bab2a7;color:#383b4e;">Tutup</button>
      </div>
      <div class="space-y-4">
        <div class="flex items-center space-x-2">
          <span class="text-sm text-[#383b4e]">Rating:</span>
          <div id="ratingStars" class="flex space-x-1"></div>
          <span id="ratingValue" class="text-sm font-semibold text-[#383b4e]">(0)</span>
        </div>
        <textarea id="ratingNote" rows="3" placeholder="Tulis komentar (opsional)"
          class="w-full border border-[#bab2a7] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#798e9d]"></textarea>
        <button id="submitUlas" class="w-full py-2 rounded-lg text-white font-semibold"
          style="background-color:#383b4e;">Kirim</button>
      </div>
    </div>
  </div>

  <script>
    // === DROPDOWN PROFIL ===
    const profileBtn = document.getElementById("profileBtn");
    const profileMenu = document.getElementById("profileMenu");

    profileBtn.addEventListener("click", () => {
      profileMenu.classList.toggle("hidden");
    });

    // klik di luar dropdown -> tutup
    document.addEventListener("click", (e) => {
      if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
        profileMenu.classList.add("hidden");
      }
    });

    // tombol logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      alert("Anda berhasil logout!");
      window.location.href = "login.html"; // arahkan ke login.html (bisa kamu ubah)
    });

    // === SCRIPT LAIN PUNYA KAMU TETAP ===
    // (search, filter, favorit, ulasan, dll...)
  </script>
  <script>
    // ================== DATA UMKM ==================
    // Tambah field 'wa' (nomor WhatsApp), ratingNumber & ratingCount agar ulasan bisa mempengaruhi rata-rata
    const UMKMData = [
      { id:1, nama:"Buket Sari Mawar", kategori:"Karya Seni", lokasi:"Desa Sumberlele", harga:75000, deskripsi:"Buket bunga segar untuk wisuda, ulang tahun, dan acara spesial.", wa:"628123001001", ratingNumber:4.7, ratingCount:23 },
      { id:2, nama:"Kerajinan Bambu Asri", kategori:"Kerajinan", lokasi:"Desa Sumberlele", harga:45000, deskripsi:"Tas anyaman, tempat pensil, dan hiasan dinding dari bambu.", wa:"628123001002", ratingNumber:4.9, ratingCount:31 },
      { id:3, nama:"Kue Tradisional Mak Yani", kategori:"Kue", lokasi:"Desa Kebon Agong", harga:25000, deskripsi:"Kue lapis, onde-onde, klepon, dan jajanan pasar lainnya.", wa:"628123001003", ratingNumber:4.5, ratingCount:18 },
      { id:4, nama:"Keripik Singkong Bu Dewi", kategori:"Olahan", lokasi:"Desa Kebon Agung", harga:15000, deskripsi:"Keripik singkong renyah dengan berbagai varian rasa pedas manis.", wa:"628123001004", ratingNumber:4.3, ratingCount:14 },
      { id:5, nama:"Rajut Cantik Handmade", kategori:"Kerajinan", lokasi:"Desa Asembakor", harga:85000, deskripsi:"Tas rajut, topi, dan aksesoris rajutan dengan motif unik.", wa:"628123001005", ratingNumber:4.8, ratingCount:40 },
      { id:6, nama:"Sambal Pecel Bu Tini", kategori:"Olahan", lokasi:"Desa Sumberlele", harga:12000, deskripsi:"Sambal pecel khas Jawa Timur, pedas gurih untuk lalapan.", wa:"628123001006", ratingNumber:4.6, ratingCount:21 }
    ];

    // Muat pembaruan rating tersimpan (localStorage)
    const savedRatings = JSON.parse(localStorage.getItem("UMKMMart_ratings") || "{}");
    for (const id in savedRatings) {
      const idx = UMKMData.findIndex(j => j.id === Number(id));
      if (idx > -1) Object.assign(UMKMData[idx], savedRatings[id]);
    }

    let favoritData = []; // simpan id UMKM yang di-favoritkan

    const UMKMGrid = document.getElementById("UMKMGrid");
    const searchInput = document.getElementById("searchInput");
    const lokasiInput = document.getElementById("lokasiInput");
    const rangeHarga = document.getElementById("rangeHarga");
    const labelHarga = document.getElementById("labelHarga");
    const favoritList = document.getElementById("favorit-list");

    // ===== Helper: render bintang & teks rating
    function starText(avg){
      const full = Math.floor(avg);
      const half = (avg - full >= 0.5) ? 1 : 0;
      const empty = 5 - full - half;
      return "â˜…".repeat(full) + (half ? "â˜†" : "") + "â˜†".repeat(empty);
    }
    function ratingLabel(j){
      return `${starText(j.ratingNumber)} (${j.ratingNumber.toFixed(1)})`;
    }

    // ================== RENDER CARD DI BERANDA ==================
    function renderUMKM(data){
      UMKMGrid.innerHTML = "";
      if(data.length === 0){
        UMKMGrid.innerHTML = `<p class="col-span-3 text-center text-gray-600">Tidak ada UMKM ditemukan</p>`;
        return;
      }
      data.forEach(j => {
        const isFav = favoritData.includes(j.id);
        const waLink = `https://wa.me/${j.wa}?text=${encodeURIComponent("Halo "+j.nama+", saya tertarik menggunakan UMKM Anda.")}`;
        const [stars, paren] = [ratingLabel(j).split(" ")[0], `(${j.ratingNumber.toFixed(1)})`];

        UMKMGrid.innerHTML += `
          <div class="card bg-white rounded-xl shadow-md p-4">
            <h3 class="font-bold text-lg">${j.nama}</h3>
            <p class="text-sm mb-2">${j.deskripsi} <br> <span class="italic">${j.lokasi}</span></p>
            <p class="font-semibold mb-2 text-[#798e9d]">Rp ${j.harga.toLocaleString("id-ID")} / sesi</p>
            <div class="flex items-center mb-4">
              <span class="text-yellow-400">${stars}</span>
              <span class="ml-2 text-sm text-gray-500">${paren}</span>
            </div>
            <div class="flex justify-between items-center">
              <a href="${waLink}" target="_blank" rel="noopener" class="text-white px-3 py-1 rounded-lg" style="background-color:#383b4e;">Hubungi</a>
              <button class="ulasan-btn text-sm text-[#4c3d3e]" data-id="${j.id}">Ulas</button>
              <button class="favorite-btn ${isFav ? "text-red-500" : "text-gray-400"} text-lg" data-id="${j.id}">â™¥</button>
            </div>
          </div>
        `;
      });

      // Event tombol favorit
      document.querySelectorAll(".favorite-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = parseInt(btn.dataset.id);
          if(favoritData.includes(id)){
            favoritData = favoritData.filter(f=>f!==id); // hapus dari favorit
          }else{
            favoritData.push(id); // tambah ke favorit
          }
          applyFilter(); // re-render beranda
          renderFavorit(); // update halaman favorit
        });
      });

      // Event tombol ulas
      document.querySelectorAll(".ulasan-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          openUlasModal(parseInt(btn.dataset.id));
        });
      });
    }

    // ================== RENDER FAVORIT ==================
    function renderFavorit(){
      favoritList.innerHTML = "";
      if(favoritData.length === 0){
        favoritList.innerHTML = `<p class="col-span-3 text-center text-gray-600">Belum ada favorit</p>`;
        return;
      }
      UMKMData.filter(j=>favoritData.includes(j.id)).forEach(j=>{
        const waLink = `https://wa.me/${j.wa}?text=${encodeURIComponent("Halo "+j.nama+", saya tertarik menggunakan UMKM Anda.")}`;
        favoritList.innerHTML += `
          <div class="card bg-white rounded-xl shadow-md p-4">
            <h3 class="font-bold text-lg">${j.nama}</h3>
            <p class="text-sm mb-2">${j.deskripsi} <br> <span class="italic">${j.lokasi}</span></p>
            <p class="font-semibold mb-2 text-[#798e9d]">Rp ${j.harga.toLocaleString("id-ID")} / sesi</p>
            <div class="flex items-center mb-4">
              <span class="text-yellow-400">${starText(j.ratingNumber)}</span>
              <span class="ml-2 text-sm text-gray-500">(${j.ratingNumber.toFixed(1)})</span>
            </div>
            <div class="flex justify-between items-center">
              <a href="${waLink}" target="_blank" rel="noopener" class="text-white px-3 py-1 rounded-lg" style="background-color:#383b4e;">Hubungi</a>
              <button class="ulasan-btn text-sm text-[#4c3d3e]" data-id="${j.id}">Ulas</button>
              <button class="favorite-btn text-red-500 text-lg" data-id="${j.id}">â™¥</button>
            </div>
          </div>
        `;
      });

      // aktifkan event favorite di halaman favorit juga
      document.querySelectorAll("#favorit .favorite-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = parseInt(btn.dataset.id);
          favoritData = favoritData.filter(f=>f!==id); // hapus dari favorit
          applyFilter(); // update list UMKM di beranda
          renderFavorit(); // update halaman favorit
        });
      });

      // ulasan dari halaman favorit
      document.querySelectorAll("#favorit .ulasan-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          openUlasModal(parseInt(btn.dataset.id));
        });
      });
    }

    // ================== FILTER FUNCTION ==================
    function applyFilter(){
      let keyword = searchInput.value.toLowerCase();
      let lokasi = lokasiInput.value.toLowerCase();
      let maxHarga = parseInt(rangeHarga.value);
      let kategoriActive = document.querySelector(".kategori-btn.active")?.dataset.kategori || "all";

      let hasil = UMKMData.filter(j => {
        let cocokNama = j.nama.toLowerCase().includes(keyword) || j.deskripsi.toLowerCase().includes(keyword);
        let cocokLokasi = lokasi === "" || j.lokasi.toLowerCase().includes(lokasi);
        let cocokHarga = j.harga <= maxHarga;
        let cocokKategori = kategoriActive === "all" || j.kategori === kategoriActive;
        return cocokNama && cocokLokasi && cocokHarga && cocokKategori;
      });

      labelHarga.innerText = `â‰¤ Rp.${maxHarga.toLocaleString("id-ID")}`;
      renderUMKM(hasil);
    }

    // ================== EVENT LISTENER ==================
    searchInput.addEventListener("input", applyFilter);
    lokasiInput.addEventListener("input", applyFilter);
    rangeHarga.addEventListener("input", applyFilter);

    document.querySelectorAll(".kategori-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".kategori-btn").forEach(b=> b.classList.remove("bg-[#798e9d]","text-white","active"));
        btn.classList.add("bg-[#798e9d]","text-white","active");
        applyFilter();
      });
    });

    // Hero button scroll ke search
    document.getElementById("heroSearchBtn").addEventListener("click", ()=>{
      document.getElementById("searchSection").scrollIntoView({behavior:"smooth"});
    });

    // Navigasi antar section
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
        document.getElementById(btn.dataset.target).classList.remove('hidden');

        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('bg-[#798e9d]'));
        btn.classList.add('bg-[#798e9d]');

        if(btn.dataset.target === "favorit"){ // auto refresh favorit
          renderFavorit();
        }
      });
    });

    // ================== MODAL ULAS ==================
    const ulasModal = document.getElementById("ulasModal");
    const closeUlas = document.getElementById("closeUlas");
    const ratingStars = document.getElementById("ratingStars");
    const ratingValue = document.getElementById("ratingValue");
    const ratingNote  = document.getElementById("ratingNote");
    const submitUlas  = document.getElementById("submitUlas");
    let currentUlasId = null;
    let chosenRating = 0;

    function drawStars(current=0){
      ratingStars.innerHTML = "";
      for(let i=1;i<=5;i++){
        const b = document.createElement("button");
        b.type="button";
        b.className="text-2xl";
        b.textContent = i<=current ? "â˜…" : "â˜†";
        b.style.color = i<=current ? "#fbbf24" : "#9ca3af"; // amber-400 / gray-400
        b.addEventListener("click", ()=>{
          chosenRating = i;
          drawStars(i);
        });
        ratingStars.appendChild(b);
      }
      ratingValue.textContent = `(${current})`;
    }

    function openUlasModal(id){
      currentUlasId = id;
      chosenRating = 0;
      ratingNote.value = "";
      drawStars(0);
      ulasModal.classList.remove("hidden");
      ulasModal.classList.add("flex");
    }
    function closeModal(){
      ulasModal.classList.add("hidden");
      ulasModal.classList.remove("flex");
    }
    closeUlas.addEventListener("click", closeModal);
    ulasModal.addEventListener("click", (e)=>{ if(e.target === ulasModal) closeModal(); });

    submitUlas.addEventListener("click", ()=>{
      if(!currentUlasId) return;
      if(chosenRating === 0){
        alert("Pilih rating 1â€“5 dulu ya.");
        return;
      }
      const j = UMKMData.find(x=>x.id===currentUlasId);
      if(!j) return;

      // update rata-rata
      const total = j.ratingNumber * j.ratingCount + chosenRating;
      j.ratingCount += 1;
      j.ratingNumber = total / j.ratingCount;

      // simpan ke localStorage biar persistent
      const map = JSON.parse(localStorage.getItem("UMKMMart_ratings") || "{}");
      map[j.id] = { ratingNumber: j.ratingNumber, ratingCount: j.ratingCount };
      localStorage.setItem("UMKMMart_ratings", JSON.stringify(map));

      // (opsional) komentar bisa dipakai nanti
      // const note = ratingNote.value.trim();

      applyFilter();      // re-render kartu di beranda dgn rating baru
      renderFavorit();    // re-render favorit jika terbuka
      closeModal();
    });

    // Inisialisasi awal
    applyFilter();   // ini sekaligus render awal
    renderFavorit();
  </script>

</body>
</html>
